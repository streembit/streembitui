<div id="uiview-container" class="uiview-container-view-info panel m-4" data-bind="visible: !iothubs().length">
    <div class="uiview-plane">
        <div class="uiview-container-panel container-fluid">

            <div class="uiview-container-panel-header panel-hdr">
                <h4 class="px-0">Please configure an Streembit IOT gateway</h4>
            </div>

            <p class="uiview-container-panel-text-lg">
                Create here your Streembit controlled IoT gateway!
            </p>

            <button class="btn btn-primary" data-bind="click: create">Create Hub</button>
        </div>
    </div>
</div>

<div data-bind="visible: iothubs().length, foreach: iothubs" class="row" style="margin:0;">
    <div class="col-md-12 iothub">
        <div class="iothub-header">
            <div class="float-left" style="padding:5px 0 0 8px;"><span data-bind="text:name"></span></div>
            <div class="btn-group display-inline float-right text-align-left hidden-tablet" style="padding:6px 5px 5px 0">
                <button class="btn btn-xs btn-light" data-bind="click: toggle_shownetwork_info" data-toggle="tooltip" data-placement="bottom" title="Network info">
                    <i class="fa fa-info-circle fa-lg"></i>
                </button>
                <!--<button class="btn btn-xs btn-light" data-bind="click: show_device_list" data-toggle="tooltip" data-placement="bottom" title="List devices">
                    <i class="fa fa-list-ul fa-lg"></i>
                </button>-->
                <button class="btn btn-xs btn-light" data-bind="click: edit_hub" data-toggle="tooltip" data-placement="bottom" title="Edit Hub">
                    <i class="fa fa-cog fa-lg"></i>
                </button>
                <button class="btn btn-xs btn-light" data-bind="click: $component.removehub" data-toggle="tooltip" data-placement="bottom" title="Delete Hub">
                    <i class="fa fa-remove fa-lg"></i>
                </button>
            </div>
            <div class="float-right">
                <div class="float-left" style="padding:5px 10px 0 0;">
                    <span data-bind="css:{'authenticated':  authenticated() == true}"></span>
                </div>
            </div>
            <div style="clear:both"></div>
        </div>
        <div data-bind="template: network_info_template" style="position:relative">
        </div>
        <div data-bind="template: template_name">
        </div>

        <div data-bind="foreach: iotdevices, visible: isedit_mode() == false" class="row" style="margin:0">
            <div class="col-md-3 iothub-iotdevice-frame">
                <div class="iothub-iotdevice">
                    <div class="title">
                        <div class="float-left" style="padding: 6px 5px 5px 5px;"><span data-bind="text: name"></span></div>
                        <div class="btn-group display-inline float-right text-align-left hidden-tablet" style="padding:6px 5px 5px 0">
                            <button class="btn btn-xs btn-light" data-bind="click: refresh">
                                <i class="fa fa-refresh fa-lg"></i>
                            </button>
                            <button class="btn btn-xs btn-light" data-bind="click: toggle_shownetwork_info">
                                <i class="fa fa-info-circle fa-lg"></i>
                            </button>
                            <button class="btn btn-xs btn-light" data-bind="click: edit_device">
                                <i class="fa fa-cog fa-lg"></i>
                            </button>
                            <button class="btn btn-xs btn-light" data-bind="click: function(){ $parent.delete_device($data, $parent); }">
                                <i class="fa fa-remove fa-lg"></i>
                            </button>
                        </div>
                        <div style="clear:both"></div>
                    </div>
                    <div data-bind="template: network_info_template" style="position:relative">
                    </div>
                    <div data-bind="template: template_name" class="iothub-iotdevice-details">

                    </div>
                </div>
            </div>
        </div>
        <div style="text-align:left;" data-bind="visible: isedit_mode()">
            <button class="btn btn-light btn-small btn-cancel-settings" data-bind="click: cancel_edit_hub">
                Close
            </button>
        </div>
    </div>
</div>

<!-- Feature specific templates -->
<script type="text/html" id="receiving-data">
    <div class="data-notreceived-info">
        <span class="inactive-device-info">Receiving data </span> <i class="fa fa-circle-o-notch fa-spin fa-2x fa-fw"></i>
    </div>
</script>

<script type="text/html" id="feature-error-deviceoffline">
    <div class="data-notreceived-info">
        <span class="inactive-device-info">The device is offline.</span>
    </div>
</script>

<script type="text/html" id="feature-inactive-device">
    <div class="data-notreceived-info">
        <span class="inactive-device-info">Device is inactive ...</span>
    </div>
</script>

<script type="text/html" id="feature-on-off-switch">
    <div style="display: flex;width: 100%;justify-content: center">
        <div class="onoffswitch" style="margin:15px">
            <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="myonoffswitch" data-bind="switchbtn: ctrlstatus">
            <label class="onoffswitch-label" for="myonoffswitch">
                <span class="onoffswitch-inner"></span>
                <span class="onoffswitch-switch"></span>
            </label>
        </div>
        <div style="clear:both"></div>
    </div>
</script>

<script type="text/html" id="feature-occupancy-sensing">
    <div style="display: flex;width: 100%;justify-content: center">
        <div class="occupancy-sensor" style="margin:15px">
            <div>
                <i class="fa fa-bell fa-5x" data-bind="css: {'faa-ring': isoccupancy, animated: isoccupancy, 'occupancy-alarmed': isoccupancy}"></i>
            </div>
        </div>
    </div>
</script>

<script type="text/html" id="feature-electric-measurement">
    <div style="padding:10px;text-align:center">
        <div>
            Power consumption: <span data-bind="text: power_consumption"></span> Watt
        </div>
        <div>
            Voltage: <span data-bind="text: voltage"></span> Volt
        </div>
    </div>
</script>

<script type="text/html" id="feature-temperature-measurement">
    <div style="margin:15px 0">
        <div style="position: relative;">
            <div class="temperature">
                <i class="fa fa-thermometer-three-quarters fa-5" style="color:#aaa"></i>&nbsp;<span data-bind="text: integral">1</span><span class="decimal">.</span><span class="decimal" data-bind="text: decimal">9</span><strong>&deg;</strong>
            </div>
        </div>
    </div>
</script>

<script type="text/html" id="feature-relhumidity-measurement">
    <div style="margin:15px 0">
        <div style="position: relative;">
            <div class="humidity">
                <i class="fa fa-tint fa-5" style="color:#aaa"></i>&nbsp;<span data-bind="text: integral">1</span><span class="decimal">.</span><span class="decimal" data-bind="text: decimal">9</span><strong>&percnt;</strong>
            </div>
        </div>
    </div>
</script>

<script type="text/html" id="feature-occupancy-sensing">
    <div>
        Occupancy Sensing
    </div>
</script>

<script type="text/html" id="feature-template">
    <div data-bind="template: template_name">
    </div>
</script>


<script type="text/html" id="features-template">
    <div data-bind="foreach: features">
        <div class="device-feature-item" data-bind="template: {name: 'feature-template' }">
        </div>
    </div>
</script>


<script type="text/html" id="gateway-info-template">
    <div class="device-net-info" style="right:0;top:3px" data-bind="click: toggle_shownetwork_info">
        <table>
            <tr><td>Status: </td> <td data-bind="text: authenticated() ? 'AUTHENTICATED' : 'OFFLINE'"></td></tr>
            <tr><td>Host: </td> <td data-bind="text: host"></td></tr>
            <tr><td>Port: </td> <td data-bind="text: port"></td></tr>
            <tr><td>Device ID: </td> <td data-bind="text: id"></td></tr>
            <tr><td>Network: </td> <td data-bind="text: networkinfo.platform"></td></tr>
            <tr><td>Manufacturer: </td> <td data-bind="text: networkinfo.manufacturername"></td></tr>
            <tr><td>Model: </td> <td data-bind="text: networkinfo.modelidentifier"></td></tr>
            <tr><td>Hardware version: </td> <td data-bind="text: networkinfo.hwversion"></td></tr>
            <tr><td>Protocol: </td> <td data-bind="text: networkinfo.protocol"></td></tr>
            <tr><td>Security: </td> <td data-bind="text: networkinfo.security"></td></tr>
            <tr><td>Secure_hardware: </td> <td data-bind="text: networkinfo.secure_hardware"></td></tr>
            <tr><td>MCU Address64: </td> <td data-bind="text: authenticated() ? networkinfo.address64 : ''"></td></tr>
            <tr><td>MCU Address16: </td> <td data-bind="text: networkinfo.address16"></td></tr>
            <tr><td>Public key: </td> <td data-bind="text: publickey"></td></tr>
        </table>
    </div>
</script>

<script type="text/html" id="zigbee-info-template">
    <div class="device-net-info" data-bind="click: $parent.toggle_shownetwork_info">
        <table>
            <tr><td>Manufacturer: </td> <td data-bind="text: networkinfo.manufacturername"></td></tr>
            <tr><td>Model: </td> <td data-bind="text: networkinfo.modelidentifier"></td></tr>
            <tr><td>Hardware version: </td> <td data-bind="text: networkinfo.hwversion"></td></tr>
            <tr><td>Network: </td> <td>Zigbee</td></tr>
            <tr><td>Address64: </td> <td data-bind="text: networkinfo.address64"></td></tr>
            <tr><td>Address16: </td> <td data-bind="text: networkinfo.address16"></td></tr>
        </table>
    </div>
</script>

<script type="text/html" id="zwave-info-template">
    <div class="device-net-info">
        Z-Wave net info
    </div>
</script>

<script type="text/html" id="slowpan-info-template">
    <div class="device-net-info">
        6LowPAN net info
    </div>
</script>


<script type="text/html" id="smart_plug_device">
    <div class="onoff_switch">
        <div style="display:flex;flex-direction: row">
            <div style="flex-grow:1">
                <div class="onoffswitch">
                    <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="myonoffswitch" data-bind="switchbtn: ctrlstatus">
                    <label class="onoffswitch-label" for="myonoffswitch">
                        <span class="onoffswitch-inner"></span>
                        <span class="onoffswitch-switch"></span>
                    </label>
                </div>
            </div>
            <div style="flex-grow:1">
                <div style="padding-top: 12px;">
                    Device reported status: <span data-bind="text: statustext" style="font-weight:bold"></span>
                </div>
            </div>
        </div>

        <div>
            <span>Power consumption: </span> <span data-bind="text: power_consumption"></span>
        </div>
        <div>
            <span>Voltage: </span> <span data-bind="text: voltage"></span>
        </div>
    </div>
</script>

<script type="text/html" id="smart_plug_device_settings">
    <div class="form-group" style="margin-bottom:20px">
        <div>Device type: <span style="font-weight:bold">ON/OFF switch</span></div>
    </div>
    <div class="form-group" style="margin-bottom:20px">
        <label>Refresh interval</label>
        <input class="form-control" type="number" min="30000" max="3600000" data-bind="value: refresh_interval" style="max-width:150px">
        <div data-bind="visible: is_interval_error">
            <em id="id-error" class="invalid error-label">A valid number is required between 30,000 and 3,600,000.</em>
        </div>
    </div>
</script>

<script type="text/html" id="onoff_switch_device">
    <div class="onoff_switch">
        <div style="display:flex;flex-direction: row">
            <div style="flex-grow:1">
                <div class="onoffswitch">
                    <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="myonoffswitch" data-bind="switchbtn: ctrlstatus" >
                    <label class="onoffswitch-label" for="myonoffswitch">
                        <span class="onoffswitch-inner"></span>
                        <span class="onoffswitch-switch"></span>
                    </label>
                </div>
            </div>
            <div  style="flex-grow:1">
                <div style="padding-top: 12px;">
                    Device reported status: <span data-bind="text: statustext" style="font-weight:bold"></span>
                </div>
            </div>
        </div>

        <div>
            <span>Power consumption: </span> <span data-bind="text: power_consumption"></span>
        </div>
        <div>
            <span>Voltage: </span> <span data-bind="text: voltage"></span>
        </div>
    </div>
</script>

<script type="text/html" id="onoff_switch_device_settings">
    <div class="form-group" style="margin-bottom:20px">
        <div>Device type: <span style="font-weight:bold">ON/OFF switch</span></div>
    </div>
    <div class="form-group" style="margin-bottom:20px">
        <label>Refresh interval</label>
        <input class="form-control" type="number" min="30000" max="3600000" data-bind="value: refresh_interval" style="max-width:150px">
        <div data-bind="visible: is_interval_error">
            <em id="id-error" class="invalid error-label">A valid number is required between 30,000 and 3,600,000.</em>
        </div>
    </div>
</script>

<script type="text/html" id="add_device">
    <div data-bind="component:{name: 'addiotdevice', params: $data}">
    </div>
</script>

<script type="text/html" id="edit_hub">
    <div class="row" style="margin:0; padding:0">
        <div class="col-sm-12 col-md-12" style="padding-left:0;padding-right:0;">
            <div style="margin-top:20px">
                <header class="tabs-header">
                    <ul class="nav nav-tabs hub-details pull-right" role="tablist">
                        <li role="presentation">
                            <a data-toggle="tab" href="#edithub_details" role="tab" class="active show">
                                <i class="fa fa-lg fa-arrow-circle-o-up"></i>
                                <span class="hidden-mobile hidden-tablet"> Edit Hub details </span>
                            </a>
                        </li>
                        <li role="presentation">
                            <a data-toggle="tab" href="#edithub_devices" role="tab">
                                <i class="fa fa-lg fa-arrow-circle-o-down"></i>
                                <span class="hidden-mobile hidden-tablet"> Manage Hub devices </span>
                            </a>
                        </li>
                        <li role="presentation">
                            <a data-toggle="tab" href="#edithub_control" role="tab">
                                <i class="fa fa-lg fa-arrow-circle-o-down"></i>
                                <span class="hidden-mobile hidden-tablet"> Control Hub </span>
                            </a>
                        </li>
                        <li role="presentation">
                            <a data-toggle="tab" href="#edithub_users" role="tab">
                                <i class="fa fa-lg fa-arrow-circle-o-down"></i>
                                <span class="hidden-mobile hidden-tablet"> Manage Hub users </span>
                            </a>
                        </li>
                    </ul>
                </header>

                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane active" id="edithub_details">
                        <div style="margin:20px 2%;">
                            <!-- ko if: isCurrentUserAdmin() -->
                            <div class="jarviswidget jarviswidget-sortable" id="hub-details" data-widget-editbutton="false" data-widget-custombutton="false" role="widget">
                                <header role="heading" class="ui-sortable-handle">
                                    <span class="widget-icon"> <i class="fa fa-edit"></i> </span>
                                    <h2>Hud ID: <span data-bind="text: id" style="font-weight:bold"></span></h2>
                                    <span class="jarviswidget-loader"><i class="fa fa-refresh fa-spin"></i></span>
                                </header>

                                <div role="content">
                                    <div class="widget-body no-padding">
                                        <form action="" class="smart-form" novalidate="novalidate">
                                            <fieldset>
                                                <div class="row">
                                                    <section class="col col-12">
                                                        <label>Hub name</label>
                                                        <label class="input"> <i class="icon-append fa fa-microchip"></i>
                                                            <input type="text" data-bind="value: newname" placeholder="Hub name">
                                                        </label>
                                                        <div data-bind="visible: is_newname_error">
                                                            <em class="invalid error-label">This field is required.</em>
                                                        </div>
                                                    </section>
                                                </div>

                                                <div class="row">
                                                    <section class="col col-12">
                                                        <label>Public key</label>
                                                        <label class="input"> <i class="icon-append fa fa-key"></i>
                                                            <input type="text" placeholder="BS58 encoded public key" type="text" data-bind="value: newpublickey">
                                                        </label>
                                                        <div data-bind="visible: is_newid_error">
                                                            <em class="invalid error-label">This field is required.</em>
                                                        </div>
                                                    </section>
                                                </div>
                                            </fieldset>

                                            <footer>
                                                <button class="btn btn-primary btn-sm" data-bind="click: submit_edit_hub">
                                                    <i class="fa fa-save"></i>
                                                    Update Hub
                                                </button>
                                            </footer>
                                        </form>
                                        <!-- /ko -->
                                    </div>
                                </div>
                            </div>
                            <!-- /ko -->
                            <!-- ko if: !isCurrentUserAdmin() -->
                            <div class="table-responsive">
                                <table class="table table-bordered table-striped responsive-utilities">
                                    <thead>
                                    <tr>
                                        <th>Hub ID</th>
                                        <th>Hub Name</th>
                                        <th>Hub Public key</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <th data-bind="text: id"></th>
                                        <td data-bind="text: newname"></td>
                                        <td data-bind="text: newpublickey" class="wrapup"></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <!-- /ko -->
                        </div>
                    </div>
                    <div role="tabpanel" class="tab-pane" id="edithub_devices">
                        <div class="all_devices_edit">


                            <div class="table-responsive">
                                <table class="table table-bordered table-striped responsive-utilities">
                                    <thead>
                                    <tr>
                                        <th style="width: 160px;">Name</th>
                                        <th>Value</th>
                                    </tr>
                                    </thead>
                                    <tbody data-bind="foreach: hubdevicelist">
                                    <tr>
                                        <th>Device ID</th>
                                        <td class="is-visible" data-bind="text: deviceid"></td>
                                    </tr>
                                    <tr>
                                        <th>Device type</th>
                                        <td class="is-visible" data-bind="text: typename"></td>
                                    </tr>
                                    <tr>
                                        <th>Device name</th>
                                        <td class="is-visible" data-bind="text: name"></td>
                                    </tr>
                                    <tr>
                                        <th>Model</th>
                                        <td class="is-visible" data-bind="text: details.modelidentifier"></td>
                                    </tr>
                                    <tr>
                                        <th>Manufacturer</th>
                                        <td class="is-visible" data-bind="text: details.manufacturername"></td>
                                    </tr>
                                    <tr>
                                        <th>Hardware version</th>
                                        <td class="is-visible" data-bind="text: details.manufacturername"></td>
                                    </tr>
                                    <tr>
                                        <th>Permission</th>
                                        <td class="is-visible" data-bind="text: details.hwversion"></td>
                                    </tr>
                                    <tr>
                                        <th><!-- ko if: uipermission() == 0 -->Not provisioned<!-- /ko --></th>
                                        <td>
                                            <!-- ko if: uipermission() == 1 -->
                                            <i class="fa fa-check-circle fa-lg"style="color:#11a724"></i> <span>Allowed</span>
                                            <!-- /ko -->
                                            <!-- ko if: uipermission() == 2 -->
                                            <i class="fa fa-times-circle fa-lg" style="color:#cc0101"></i> <span>Not permitted</span>
                                            <!-- /ko -->
                                        </td>
                                    </tr>
                                    <!-- ko if: (type == 2 && uipermission() == 0) || (type == 2 && uipermission() == 1) || (type == 2 && uipermission() == 2) -->
                                    <tr>
                                        <th></th>
                                        <td>
                                            <!-- ko if: type == 2 && uipermission() == 0 -->
                                            <button data-bind="click: function(){ $parent.set_device_permission($data, 1, $parent); }">Allow</button>
                                            <button data-bind="click: function(){ $parent.set_device_permission($data, 2, $parent); }">Disable</button>
                                            <!-- /ko -->
                                            <!-- ko if: type == 2 && uipermission() == 1 -->
                                            <button data-bind="click: function(){ $parent.set_device_permission($data, 2, $parent); }">Disable</button>
                                            <!-- /ko -->
                                            <!-- ko if: type == 2 && uipermission() == 2 -->
                                            <button data-bind="click: function(){ $parent.set_device_permission($data, 1, $parent); }">Allow</button>
                                            <!-- /ko -->
                                        </td>
                                    </tr>
                                    <!-- /ko -->
                                    <!-- ko if: type == 2 -->
                                    <tr>
                                        <th></th>
                                        <td>
                                            <button data-bind="click: function(){ $parent.delete_device_fromdb($data, $parent); }">Delete</button>
                                        </td>
                                    </tr>
                                    <!-- /ko -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div role="tabpanel" class="tab-pane" id="edithub_control">
                        <div class="jarviswidget" style="margin:20px 2%;" data-widget-colorbutton="false" data-widget-editbutton="false" data-widget-fullscreenbutton="false" data-widget-custombutton="false" data-widget-sortable="false" role="widget">
                            <header role="heading">
                                <h2>Enable device join on Hub</h2>
                                <span class="jarviswidget-loader"><i class="fa fa-refresh fa-spin"></i></span>
                            </header>

                            <div role="content">
                                <div class="widget-body">
                                    <div class="tab-content">
                                        <div class="tab-pane active">
                                            <p>
                                                Join interval in seconds (max 240 seconds)
                                            </p>
                                            <p>
                                                <input type="number" style="max-width:100px" max="240" min="30" data-bind="value: new_join_interval"/>
                                                &nbsp;&nbsp;<button data-bind="click: enable_gateway_join">Enable</button>
                                            </p>
                                            <p>
                                                Remaining join time <span data-bind="text: enable_timer"></span> seconds.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div role="tabpanel" class="tab-pane" id="edithub_users">
                        <div>
                            <div style="padding:50px">
                                <div class="row">
                                    <article class="col-sm-12 col-md-12 col-lg-12">
                                        <!-- ko if: isCurrentUserAdmin() -->
                                        <span class="fa fa-user-plus users-hub" data-bind="visible: !user_add_active(), click: toggle_adduser"></span>

                                        <div class="jarviswidget jarviswidget-sortable" id="adduser" data-bind="visible: user_add_active()" data-widget-editbutton="false" data-widget-custombutton="false" role="widget">
                                            <header role="heading" class="ui-sortable-handle">
                                                <span class="widget-icon"> <i class="fa fa-edit"></i> </span>
                                                <h2>Add user</h2>
                                                <span class="jarviswidget-loader"><i class="fa fa-refresh fa-spin"></i></span>
                                            </header>

                                            <div role="content">
                                                <div class="widget-body no-padding">
                                                    <form action="" class="smart-form" novalidate="novalidate">
                                                        <fieldset>
                                                            <div class="row">
                                                                <section class="col col-10">
                                                                    <label class="input"> <i class="icon-append fa fa-user"></i>
                                                                        <input type="text" data-bind="value: add_username" placeholder="Username">
                                                                    </label>
                                                                    <div>
                                                                        <em class="invalid error-label" data-bind="visible: adduser_form_errors()[0]">Invalid or empty username.</em>
                                                                    </div>
                                                                </section>
                                                                <section class="col col-2">
                                                                    <label class="select">
                                                                        <select data-bind="value: add_isadmin">
                                                                            <option value="nan" selected="" disabled="">Is admin</option>
                                                                            <option value="1">YES</option>
                                                                            <option value="0">NO</option>
                                                                        </select> <i></i>
                                                                    </label>
                                                                    <div>
                                                                        <em class="invalid error-label" data-bind="visible: adduser_form_errors()[1]">Admin either Yes or No.</em>
                                                                    </div>
                                                                </section>
                                                            </div>

                                                            <div class="row">
                                                                <section class="col col-12">
                                                                    <label class="input"> <i class="icon-append fa fa-key"></i>
                                                                        <input type="text" data-bind="value: add_publickey" placeholder="Public key">
                                                                    </label>
                                                                    <div data-bind="visible: adduser_form_errors()[2]">
                                                                        <em class="invalid error-label">Invalid public key.</em>
                                                                    </div>
                                                                </section>
                                                            </div>

                                                            <div class="row">
                                                                <section class="col col-12">
                                                                    <label class="input"> <i class="icon-append fa fa-cogs"></i>
                                                                        <input type="text" data-bind="value: add_settings" placeholder="Settings">
                                                                    </label>
                                                                    <div data-bind="visible: adduser_form_errors()[3]">
                                                                        <em class="invalid error-label">Settings are in form of valid JSON.</em>
                                                                    </div>
                                                                </section>
                                                            </div>
                                                        </fieldset>

                                                        <footer>
                                                            <button class="btn btn-default btn-sm" data-bind="click: toggle_adduser">
                                                                <i class="fa fa-undo"></i>
                                                                Back to Edit User
                                                            </button>
                                                            <button class="btn btn-primary btn-sm" data-bind="click: submit_add_user">
                                                                <i class="fa fa-save"></i>
                                                                Add User
                                                            </button>
                                                        </footer>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- /ko -->

                                        <!-- ko if: isCurrentUserAdmin() -->
                                        <div data-bind="foreach: users, visible: !user_add_active()">
                                            <div class="jarviswidget jarviswidget-sortable edituser" data-widget-editbutton="false" data-widget-custombutton="false" role="widget">
                                                <div role="content">
                                                    <div class="widget-body no-padding">
                                                        <form action="" class="smart-form" novalidate="novalidate">
                                                            <fieldset>
                                                                <div class="row">
                                                                    <section class="col col-9">
                                                                        <label>Username</label>
                                                                        <label class="input"> <i class="icon-append fa fa-user"></i>
                                                                            <input type="text" data-bind="value: username" placeholder="Username">
                                                                        </label>
                                                                        <div data-bind="visible: $parent.user_form_errors()[$index()].username">
                                                                            <em class="invalid error-label">Invalid or empty username.</em>
                                                                        </div>
                                                                    </section>
                                                                    <section class="col col-3">
                                                                        <label>Is admin</label>
                                                                        <label class="select">
                                                                            <select data-bind="value: isadmin">
                                                                                <!-- ko if: isadmin -->
                                                                                <option value="1" selected="">Yes</option>
                                                                                <option value="2">No</option>
                                                                                <!-- /ko -->
                                                                                <!-- ko if: !isadmin -->
                                                                                <option value="1">Yes</option>
                                                                                <option value="0" selected="">No</option>
                                                                                <!-- /ko -->
                                                                            </select> <i></i>
                                                                        </label>
                                                                        <div data-bind="visible: $parent.user_form_errors()[$index()].isadmin">
                                                                            <em class="invalid error-label">Admin either yes or no.</em>
                                                                        </div>
                                                                    </section>
                                                                </div>

                                                                <div class="row">
                                                                    <section class="col col-12">
                                                                        <label>Public key</label>
                                                                        <label class="input"> <i class="icon-append fa fa-key"></i>
                                                                            <input type="text" data-bind="value: publickey" placeholder="Public key">
                                                                        </label>
                                                                        <div data-bind="visible: $parent.user_form_errors()[$index()].publickey">
                                                                            <em class="invalid error-label">Invalid public key.</em>
                                                                        </div>
                                                                    </section>
                                                                </div>

                                                                <div class="row">
                                                                    <section class="col col-12">
                                                                        <label>Settings</label>
                                                                        <label class="input"> <i class="icon-append fa fa-cogs"></i>
                                                                            <input type="text" data-bind="value: settings" placeholder="Settings">
                                                                        </label>
                                                                        <div data-bind="visible: $parent.user_form_errors()[$index()].settings">
                                                                            <em class="invalid error-label">Settings are in form of valid JSON.</em>
                                                                        </div>
                                                                    </section>
                                                                </div>
                                                            </fieldset>

                                                            <footer>
                                                                <button class="btn btn-danger btn-sm" data-bind="click: $parent.submit_delete_user.bind($parent)">
                                                                    <i class="fa fa-trash"></i>
                                                                    Delete User
                                                                </button>
                                                                <button class="btn btn-primary btn-sm" data-bind="click: $parent.submit_update_user.bind($parent)">
                                                                    <i class="fa fa-save"></i>
                                                                    Update User
                                                                </button>
                                                            </footer>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- /ko -->

                                        <!-- ko if: !isCurrentUserAdmin() -->
                                        <div data-bind="foreach: users" class="view-settings">
                                            <div class="table-responsive">
                                                <table class="table table-bordered table-striped responsive-utilities">
                                                    <thead>
                                                    <tr>
                                                        <th style="width: 120px;">Name</th>
                                                        <th>Value</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    <tr>
                                                        <th>Username</th>
                                                        <td class="is-visible" data-bind="text: username"></td>
                                                    </tr>
                                                    <tr>
                                                        <th>Is admin</th>
                                                        <!-- ko if: isadmin -->
                                                        <td class="is-visible">YES</td>
                                                        <!-- /ko -->
                                                        <!-- ko if: !isadmin -->
                                                        <td class="is-visible">NO</td>
                                                        <!-- /ko -->
                                                    </tr>
                                                    <tr>
                                                        <th>Public key</th>
                                                        <td class="is-visible" data-bind="text: publickey"></td>
                                                    </tr>
                                                    <tr>
                                                        <th>Settings</th>
                                                        <td class="is-visible" data-bind="text: settings"></td>
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <!-- /ko -->
                                    </article>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>


<script type="text/html" id="manage_users">
    <div class="row" style="margin:0; padding:0">
        <article class="col-sm-12 col-md-12 col-lg-6">
            <div style="border: 1px dotted #ccc;padding:0;margin-top:20px;margin-bottom:30px">
                <form class="form-horizontal iothub-form">
                    <fieldset>
                        <legend>Manage users on the Hub</legend>
                        <div class="padding: 0"></div>
                    </fieldset>
                    <div class="form-actions">
                        <div class="row" style="margin:0">
                            <div class="col-md-12">
                                <button class="btn btn-light" data-bind="click: cancel_manage_users">
                                    Cancel
                                </button>
                                <button class="btn btn-primary" data-bind="click: submit_manage_users">
                                    <i class="fa fa-save"></i>
                                    Update Hub
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </article>
    </div>
</script>

<script type="text/html" id="manage_devices">
    <div class="row" style="margin:0; padding:0">
        <article class="col-sm-12 col-md-12 col-lg-6">
            <div style="border: 1px dotted #ccc;padding:0;margin-top:20px;margin-bottom:30px">
                <form class="form-horizontal iothub-form">
                    <fieldset>
                        <legend>Manage devices on the Hub</legend>
                        <div class="padding: 0">

                        </div>
                    </fieldset>
                    <div class="form-actions">
                        <div class="row" style="margin:0">
                            <div class="col-md-12">
                                <button class="btn btn-light" data-bind="click: cancel_manage_devices">
                                    Cancel
                                </button>
                                <button class="btn btn-primary" data-bind="click: submit_manage_devices">
                                    <i class="fa fa-save"></i>
                                    Update Hub
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </article>
    </div>
</script>


<script type="text/html" id="edit_device">
    <div class="row" style="margin:0; padding:0">
        <article class="col-sm-12 col-md-12">
            <div style="border: 1px dotted #ccc;padding:0;margin-top:5px;margin-bottom:5px">
                <form class="form-horizontal iothub-form">
                    <fieldset>
                        <legend>Edit Device</legend>
                        <div class="padding: 0">
                            <div class="form-group">
                                <label>Device ID</label>
                                <input class="form-control" placeholder="The MAC of your Zigbee/Z-wave/6LowPan device" type="text" data-bind="value: newid">
                                <div data-bind="visible: is_newid_error">
                                    <em id="id-error" class="invalid error-label">The ID field is required.</em>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Device name</label>
                                <input class="form-control" placeholder="Device name" type="text" data-bind="value: newname">
                                <div data-bind="visible: is_newname_error">
                                    <em id="id-error" class="invalid error-label">The name field is required.</em>
                                </div>
                            </div>
                            <div>
                                <!--data-bind="template: features_template"-->
                            </div>
                        </div>
                    </fieldset>
                    <div class="form-actions">
                        <div class="row" style="margin:0">
                            <div class="col-md-12">
                                <button class="btn btn-light" data-bind="click: cancel_edit">
                                    Cancel
                                </button>
                                <button class="btn btn-primary" data-bind="click: function(){ $parent.submit_edit_device($data, $parent); }">
                                    <i class="fa fa-save"></i>
                                    Update Device
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </article>
    </div>
</script>

<script type="text/html" id="unconfigured-zigbee-devices-template">
    <div style="display:flex;justify-content:center;padding:10px 30px">
        <div class="administer_devices">
            <div class="header">
                New connected devices
            </div>
            <div data-bind="foreach: unconfigured_devices" class="unconfigured_devices_items">
                <div class="unconfigured_device">
                    <!-- ko if: protocol == "zigbee" -->
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped responsive-utilities">
                            <thead>
                            <tr>
                                <th style="width: 120px;">Name</th>
                                <th>Value</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <th>Protocol</th>
                                <td class="is-visible">Zigbee</td>
                            </tr>
                            <tr>
                                <th>Device ID</th>
                                <td class="is-visible" data-bind="text: deviceid"></td>
                            </tr>
                            <tr>
                                <th>Manufacturer</th>
                                <td class="is-visible" data-bind="text: manufacturername"></td>
                            </tr>
                            <tr>
                                <th>Model</th>
                                <td class="is-visible" data-bind="text: modelidentifier"></td>
                            </tr>
                            <tr>
                                <th>Hardware version</th>
                                <td class="is-visible" data-bind="text:hwversion"></td>
                            </tr>
                            <tr>
                                <th>Address64</th>
                                <td class="is-visible" data-bind="text:address64"></td>
                            </tr>
                            <tr>
                                <th>Address16</th>
                                <td class="is-visible" data-bind="text:address16"></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <div style="margin-top:0;padding: 0 10px 5px 10px">
                        <div>Device name</div>
                        <input type="text" data-bind="value: devicename" style="min-width:200px" />
                    </div>
                    <div data-bind="foreach: features" class="featureslist">
                        <div class="checkbox">
                            <label>
                                <input type="checkbox" data-bind="checked: selected"><span data-bind="text: name"></span>
                            </label>
                        </div>
                    </div>
                    <!-- /ko -->
                    <!-- ko if: protocol == "zwave" -->
                    Z-wave TODO
                    <!-- /ko -->
                    <div class="permission_btns">
                        <label class="radio radio-inline" style="margin-top: 0">
                            <input type="radio" class="radiobox" name="permissionGroup" value="1" data-bind="checked: permitted">
                            <span>Allow</span>
                        </label>
                        <label class="radio radio-inline" style="margin-top: 0;margin-left:30px">
                            <input type="radio" class="radiobox" name="permissionGroup" value="0" data-bind="checked: permitted">
                            <span>Remove</span>
                        </label>
                    </div>
                </div>
            </div>
            <div style="margin-top:20px;width:100%;text-align:center;border-top:2px dashed #f0f0f0;padding:15px">
                <button class="btn btn-light" data-bind="click: cancel_edit_unconfigured_devices">
                    Cancel
                </button>
                <button class="btn btn-primary" data-bind="click: submit_devices_configuration">
                    <i class="fa fa-save"></i>
                    Update Hub
                </button>
            </div>
        </div>
    </div>

</script>
